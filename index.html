<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>R.M. Est√©tica Automotiva</title>
<style>
  * { box-sizing: border-box; }
  body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0; padding: 0;
    background: #f4f4f4;
  }
  h1 {
    background: linear-gradient(to right, #8B0000, #A52A2A);
    color: #fff;
    text-align: center;
    margin: 0; padding: 18px 0;
    font-size: 24px;
    user-select: none;
  }
  .menu {
    display: flex;
    flex-wrap: wrap;
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
  }
  .menu button {
    flex: 1 0 25%;
    padding: 14px 0;
    border: none;
    background: none;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
    user-select: none;
  }
  .menu button:hover, .menu button.active {
    background: #8B0000;
    color: white;
  }
  .aba {
    display: none;
    max-width: 800px;
    margin: 20px auto;
    background: white;
    padding: 20px 25px;
    border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,0,0,0.06);
  }
  .aba.active {
    display: block;
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: 600;
  }
  input, select, textarea {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 5px;
    border: 1px solid #bbb;
    font-size: 16px;
    font-family: inherit;
  }
  button.action {
    margin-top: 20px;
    background-color: #8B0000;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 6px;
    font-weight: bold;
    font-size: 17px;
    cursor: pointer;
    transition: background-color 0.3s;
    user-select: none;
  }
  button.action:hover {
    background-color: #A52A2A;
  }
  ul.list {
    margin-top: 15px;
    list-style: none;
    padding: 0;
  }
  ul.list li {
    background: #f9f9f9;
    padding: 12px 15px;
    border-left: 5px solid #8B0000;
    margin-bottom: 8px;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    user-select: none;
  }
  ul.list li > div.text {
    flex: 1;
  }
  .btn-group button {
    margin-left: 6px;
    border: none;
    background: #A52A2A;
    color: white;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s;
    user-select: none;
  }
  .btn-group button:hover {
    background: #8B0000;
  }
  .btn-group button:disabled {
    background: #ccc;
    cursor: default;
  }
  @media (max-width: 600px) {
    .menu button {
      flex: 1 0 50%;
      font-size: 14px;
      padding: 12px 0;
    }
  }
</style>
</head>
<body>

<h1>‚ú® R.M. Est√©tica Automotiva ‚ú®</h1>

<div class="menu">
  <button class="active" onclick="mostrarAba('clientes', this)">üë§ Clientes</button>
  <button onclick="mostrarAba('servicos', this)">üõ†Ô∏è Servi√ßos</button>
  <button onclick="mostrarAba('orcamentos', this)">üßæ Or√ßamentos</button>
  <button onclick="mostrarAba('historico', this)">üì¶ Hist√≥rico</button>
</div>

<!-- Clientes -->
<div id="clientes" class="aba active">
  <h2>Cadastro de Clientes</h2>
  <label for="clienteNome">Nome</label>
  <input type="text" id="clienteNome" placeholder="Nome completo" />
  <label for="clienteCarro">Carro</label>
  <input type="text" id="clienteCarro" placeholder="Modelo do carro" />
  <label for="clientePlaca">Placa</label>
  <input type="text" id="clientePlaca" placeholder="Placa do carro" maxlength="10" />
  <button class="action" onclick="salvarCliente()">Salvar Cliente</button>

  <ul id="listaClientes" class="list"></ul>
</div>

<!-- Servi√ßos -->
<div id="servicos" class="aba">
  <h2>Cadastro de Servi√ßos</h2>
  <label for="servicoNome">Nome do Servi√ßo</label>
  <input type="text" id="servicoNome" placeholder="Ex: Polimento" />
  <label for="servicoValor">Valor R$</label>
  <input type="number" id="servicoValor" placeholder="Valor do servi√ßo" min="0" step="0.01" />
  <button class="action" onclick="salvarServico()">Salvar Servi√ßo</button>

  <ul id="listaServicos" class="list"></ul>
</div>

<!-- Or√ßamentos -->
<div id="orcamentos" class="aba">
  <h2>Gerar Or√ßamento</h2>

  <label for="selectCliente">Cliente</label>
  <select id="selectCliente"></select>

  <label for="selectServico">Servi√ßo</label>
  <select id="selectServico"></select>

  <label for="desconto">Desconto (%)</label>
  <input type="number" id="desconto" value="0" min="0" max="100" />

  <label for="formaPagamento">Forma de Pagamento</label>
  <select id="formaPagamento">
    <option value="Dinheiro">Dinheiro</option>
    <option value="Cart√£o">Cart√£o</option>
    <option value="Pix">Pix</option>
    <option value="Transfer√™ncia">Transfer√™ncia</option>
  </select>

  <p><strong>Valor total: R$ <span id="valorTotal">0.00</span></strong></p>

  <button class="action" onclick="finalizarOrcamento()">Finalizar Or√ßamento</button>
</div>

<!-- Hist√≥rico -->
<div id="historico" class="aba">
  <h2>Hist√≥rico de Or√ßamentos</h2>
  <ul id="listaOrcamentos" class="list"></ul>
</div>

<script>
  // Controle de abas
  function mostrarAba(id, btn) {
    document.querySelectorAll('.aba').forEach(aba => aba.classList.remove('active'));
    document.getElementById(id).classList.add('active');

    document.querySelectorAll('.menu button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    if(id === 'orcamentos') {
      atualizarSelects();
      atualizarValorTotal();
    }
    if(id === 'historico') {
      atualizarHistorico();
    }
  }

  // Dados persistentes na sess√£o
  let clientes = JSON.parse(sessionStorage.getItem('clientes') || '[]');
  let servicos = JSON.parse(sessionStorage.getItem('servicos') || '[]');
  let orcamentos = JSON.parse(sessionStorage.getItem('orcamentos') || '[]');

  // -------- CLIENTES --------
  function salvarCliente() {
    const nome = document.getElementById('clienteNome').value.trim();
    const carro = document.getElementById('clienteCarro').value.trim();
    const placa = document.getElementById('clientePlaca').value.trim();

    if (!nome) {
      alert('Preencha o nome do cliente.');
      return;
    }

    clientes.push({ nome, carro, placa });
    sessionStorage.setItem('clientes', JSON.stringify(clientes));
    atualizarListaClientes();
    limparCamposCliente();
    alert('Cliente salvo!');
  }
  function atualizarListaClientes() {
    const ul = document.getElementById('listaClientes');
    ul.innerHTML = '';
    clientes.forEach((c, i) => {
      const li = document.createElement('li');
      li.innerHTML = `<div class="text">${c.nome} - ${c.carro} (${c.placa})</div>
        <div class="btn-group">
          <button onclick="editarCliente(${i})">Editar</button>
          <button onclick="excluirCliente(${i})">Excluir</button>
        </div>`;
      ul.appendChild(li);
    });
  }
  function limparCamposCliente() {
    document.getElementById('clienteNome').value = '';
    document.getElementById('clienteCarro').value = '';
    document.getElementById('clientePlaca').value = '';
  }
  function editarCliente(index) {
    const cliente = clientes[index];
    document.getElementById('clienteNome').value = cliente.nome;
    document.getElementById('clienteCarro').value = cliente.carro;
    document.getElementById('clientePlaca').value = cliente.placa;
    excluirCliente(index);
  }
  function excluirCliente(index) {
    if (!confirm('Confirma exclus√£o do cliente?')) return;
    clientes.splice(index, 1);
    sessionStorage.setItem('clientes', JSON.stringify(clientes));
    atualizarListaClientes();
  }

  // -------- SERVI√áOS --------
  function salvarServico() {
    const nome = document.getElementById('servicoNome').value.trim();
    const valor = parseFloat(document.getElementById('servicoValor').value);

    if (!nome) {
      alert('Preencha o nome do servi√ßo.');
      return;
    }
    if (isNaN(valor) || valor <= 0) {
      alert('Informe um valor v√°lido para o servi√ßo.');
      return;
    }

    servicos.push({ nome, valor });
    sessionStorage.setItem('servicos', JSON.stringify(servicos));
    atualizarListaServicos();
    limparCamposServico();
    alert('Servi√ßo salvo!');
  }
  function atualizarListaServicos() {
    const ul = document.getElementById('listaServicos');
    ul.innerHTML = '';
    servicos.forEach((s, i) => {
      const li = document.createElement('li');
      li.innerHTML = `<div class="text">${s.nome} - R$ ${s.valor.toFixed(2)}</div>
        <div class="btn-group">
          <button onclick="editarServico(${i})">Editar</button>
          <button onclick="excluirServico(${i})">Excluir</button>
        </div>`;
      ul.appendChild(li);
    });
  }
  function limparCamposServico() {
    document.getElementById('servicoNome').value = '';
    document.getElementById('servicoValor').value = '';
  }
  function editarServico(index) {
    const servico = servicos[index];
    document.getElementById('servicoNome').value = servico.nome;
    document.getElementById('servicoValor').value = servico.valor;
    excluirServico(index);
  }
  function excluirServico(index) {
    if (!confirm('Confirma exclus√£o do servi√ßo?')) return;
    servicos.splice(index, 1);
    sessionStorage.setItem('servicos', JSON.stringify(servicos));
    atualizarListaServicos();
  }

  // -------- OR√áAMENTOS --------
  function atualizarSelects() {
    const selCliente = document.getElementById('selectCliente');
    const selServico = document.getElementById('selectServico');
    selCliente.innerHTML = '';
    selServico.innerHTML = '';

    clientes.forEach((c, i) => {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = c.nome;
      selCliente.appendChild(option);
    });
    servicos.forEach((s, i) => {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = `${s.nome} - R$ ${s.valor.toFixed(2)}`;
      selServico.appendChild(option);
    });
  }

  document.getElementById('selectServico').addEventListener('change', atualizarValorTotal);
  document.getElementById('desconto').addEventListener('input', atualizarValorTotal);

  function atualizarValorTotal() {
    const servicoIndex = parseInt(document.getElementById('selectServico').value);
    const desconto = parseFloat(document.getElementById('desconto').value) || 0;

    if (servicoIndex >= 0 && servicos[servicoIndex]) {
      let valor = servicos[servicoIndex].valor;
      valor = valor - (valor * desconto / 100);
      document.getElementById('valorTotal').textContent = valor.toFixed(2);
    } else {
      document.getElementById('valorTotal').textContent = '0.00';
    }
  }

  function finalizarOrcamento() {
    const clienteIndex = parseInt(document.getElementById('selectCliente').value);
    const servicoIndex = parseInt(document.getElementById('selectServico').value);
    const desconto = parseFloat(document.getElementById('desconto').value) || 0;
    const formaPagamento = document.getElementById('formaPagamento').value;

    if (clienteIndex < 0 || !clientes[clienteIndex]) {
      alert('Selecione um cliente.');
      return;
    }
    if (servicoIndex < 0 || !servicos[servicoIndex]) {
      alert('Selecione um servi√ßo.');
      return;
    }

    let valor = servicos[servicoIndex].valor;
    valor = valor - (valor * desconto / 100);

    const orc = {
      cliente: clientes[clienteIndex],
      servico: servicos[servicoIndex],
      desconto,
      valor: valor.toFixed(2),
      formaPagamento,
      data: new Date().toLocaleString()
    };

    orcamentos.push(orc);
    sessionStorage.setItem('orcamentos', JSON.stringify(orcamentos));
    alert('Or√ßamento finalizado!');

    atualizarHistorico();
  }

  // -------- HIST√ìRICO --------
  function atualizarHistorico() {
    const ul = document.getElementById('listaOrcamentos');
    ul.innerHTML = '';
    orcamentos.forEach((o, i) => {
      const li = document.createElement('li');

      let textoCupom = 
`---- CUPOM FISCAL ----
R.M. Est√©tica Automotiva
Endere√ßo: RUA 40, TRAVESSA RECANTO DOS P√ÅSSAROS N 5
Tel: 24 999486232

Data: ${o.data}

Cliente: ${o.cliente.nome}
Carro: ${o.cliente.carro} (${o.cliente.placa})

Servi√ßo: ${o.servico.nome}
Forma de pagamento: ${o.formaPagamento}
Desconto: ${o.desconto}%
Valor total: R$ ${o.valor}

----------------------`;

      // Texto para enviar via WhatsApp com emojis (exemplo)
      let textoWhats = encodeURIComponent(
`‚ú® *R.M. Est√©tica Automotiva* ‚ú®
üìÖ Data: ${o.data}
üë§ Cliente: ${o.cliente.nome}
üöó Carro: ${o.cliente.carro} (${o.cliente.placa})
üõ† Servi√ßo: ${o.servico.nome}
üí∞ Valor: R$ ${o.valor}
üí≥ Pagamento: ${o.formaPagamento}
üßæ Desconto: ${o.desconto}%

*Obrigado pela prefer√™ncia!*`);

      li.innerHTML = `
        <div class="text" style="white-space: pre-line; font-family: monospace; font-size: 13px; user-select: text;">${textoCupom}</div>
        <div class="btn-group">
          <button onclick="enviarWhatsApp('${textoWhats}')">üì± Enviar WhatsApp</button>
          <button onclick="excluirOrcamento(${i})">Excluir</button>
        </div>
      `;

      ul.appendChild(li);
    });
  }

  function enviarWhatsApp(textoCodificado) {
    const numeroLoja = '5524999486232'; // DDD + telefone (Brasil)
    const url = `https://wa.me/${numeroLoja}?text=${textoCodificado}`;
    window.open(url, '_blank');
  }

  function excluirOrcamento(index) {
    if (!confirm('Confirma exclus√£o do or√ßamento?')) return;
    orcamentos.splice(index, 1);
    sessionStorage.setItem('orcamentos', JSON.stringify(orcamentos));
    atualizarHistorico();
  }

  // Inicializa√ß√£o
  atualizarListaClientes();
  atualizarListaServicos();
  atualizarHistorico();
  atualizarSelects();
  atualizarValorTotal();

</script>

</body>
</html>
